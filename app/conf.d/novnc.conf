; --- TigerVNC built-in server on DISPLAY :1 ---
[program:tigervnc]
command=/usr/bin/tigervncserver :0 -geometry %(ENV_DISPLAY_WIDTH)sx%(ENV_DISPLAY_HEIGHT)s -depth 16 -rfbport 5901 -localhost -fg -dpi 96 -desktop fluxbox -SecurityTypes None
environment=DISPLAY=":0",LANG="en_US.UTF-8"
autorestart=true
user=vscode
stdout_logfile=/var/log/novnc.log
stderr_logfile=/var/log/novnc.log
stdout_logfile_format=%(program_name)s: %(message)s
stderr_logfile_format=%(program_name)s: %(message)s

; --- noVNC proxy on 6080, pointing at localhost:5901 ---
[program:novnc]
command=/usr/share/novnc/utils/novnc_proxy --listen 6080 --vnc localhost:5901
; (adjust the noVNC version/path to whatever you installed)
autorestart=true
user=root
stdout_logfile=/var/log/novnc.log
stderr_logfile=/var/log/novnc.log
stdout_logfile_format=%(program_name)s: %(message)s
stderr_logfile_format=%(program_name)s: %(message)s

; --- (optional but recommended) preflight to clean X sockets and start dbus ---
[program:desktop-preflight]
command=/bin/sh -lc 'rm -rf /tmp/.X11-unix /tmp/.X*-lock && mkdir -p /tmp/.X11-unix && chmod 1777 /tmp/.X11-unix && (pgrep -x dbus-daemon >/dev/null || /etc/init.d/dbus start)'
priority=10
startsecs=0
autorestart=false

[group:novnc]
programs=desktop-preflight,tigervnc,novnc
priority=999